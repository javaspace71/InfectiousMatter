/*!
 * matter-tools 0.10.0 by Liam Brummitt 2017-02-04
 * https://github.com/liabru/matter-tools
 * License MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Matter")):"function"==typeof define&&define.amd?define(["Matter"],e):"object"==typeof exports?exports.Serializer=e(require("Matter")):(t.MatterTools=t.MatterTools||{},t.MatterTools.Serializer=e(t.Matter))}(this,function(t){return function(t){function e(i){if(r[i])return r[i].exports;var o=r[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="/demo/lib",e(0)}({0:function(t,e,r){"use strict";var i=t.exports={},o=r(1),n=o.Common,s=o.Engine,a=r(12);i.create=function(){var t=new a({prefix:"$",cleanup:!0});return t.parse=t.resurrect,t},i.clone=function(t,e){var r=t.parse(i.serialise(t,e));return r.id=n.nextId(),r},i.saveState=function(t,e,r){localStorage.setItem(r,i.serialise(t,e.world))},i.loadState=function(t,e,r){var i=t.parse(localStorage.getItem(r));i&&s.merge(e,{world:i})},i.serialise=function(t,e,r){return r=r||0,t.stringify(e,function(t,e){if(!/^#/.exec(t)&&"number"==typeof e){var r=parseFloat(e.toFixed(3));return 0===r&&0!==e?e:r}return e},r)}},1:function(e,r){e.exports=t},12:function(t,e){"use strict";function r(t){this.table=null,this.prefix="#",this.cleanup=!1,this.revive=!0;for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.refcode=this.prefix+"id",this.origcode=this.prefix+"original",this.buildcode=this.prefix+".",this.valuecode=this.prefix+"v"}r.GLOBAL=(0,eval)("this"),r.escapeRegExp=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},r.prototype.Error=function(t){this.message=t||"",this.stack=(new Error).stack},r.prototype.Error.prototype=Object.create(Error.prototype),r.prototype.Error.prototype.name="ResurrectError",r.NamespaceResolver=function(t){this.scope=t},r.NamespaceResolver.prototype.getPrototype=function(t){var e=this.scope[t];if(e)return e.prototype;throw new r.prototype.Error("Unknown constructor: "+t)},r.NamespaceResolver.prototype.getName=function(t){var e=t.constructor.name;if(null==e){var i=/^\s*function\s*([A-Za-z0-9_$]*)/;e=i.exec(t.constructor)[1]}if(""===e){var o="Can't serialize objects with anonymous constructors.";throw new r.prototype.Error(o)}return"Object"===e||"Array"===e?null:e},r.prototype.resolver=new r.NamespaceResolver(r.GLOBAL),r.Node=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild},r.is=function(t){var e="[object "+t+"]";return function(t){return Object.prototype.toString.call(t)===e}},r.isArray=r.is("Array"),r.isString=r.is("String"),r.isBoolean=r.is("Boolean"),r.isNumber=r.is("Number"),r.isFunction=r.is("Function"),r.isDate=r.is("Date"),r.isRegExp=r.is("RegExp"),r.isObject=r.is("Object"),r.isAtom=function(t){return!r.isObject(t)&&!r.isArray(t)},r.isPrimitive=function(t){return null==t||r.isNumber(t)||r.isString(t)||r.isBoolean(t)},r.prototype.ref=function(t){var e={};return void 0===t?e[this.prefix]=-1:e[this.prefix]=t[this.refcode],e},r.prototype.deref=function(t){return this.table[t[this.prefix]]},r.prototype.tag=function(t){if(this.revive){var e=this.resolver.getName(t);if(e){var r=Object.getPrototypeOf(t);if(this.resolver.getPrototype(e)!==r)throw new this.Error("Constructor mismatch!");t[this.prefix]=e}}return t[this.refcode]=this.table.length,this.table.push(t),t[this.refcode]},r.prototype.builder=function(t,e){var r={};return r[this.buildcode]=t,r[this.valuecode]=e,r},r.prototype.build=function(t){var e=t[this.buildcode].split(/\./).reduce(function(t,e){return t[e]},r.GLOBAL),i=[null].concat(t[this.valuecode]),o=e.bind.apply(e,i),n=new o;return r.isPrimitive(n)?n.valueOf():n},r.prototype.decode=function(t){if(this.prefix in t)return this.deref(t);if(this.buildcode in t)return this.build(t);throw new this.Error("Unknown encoding.")},r.prototype.isTagged=function(t){return this.refcode in t&&null!=t[this.refcode]},r.prototype.visit=function(t,e,i){if(r.isAtom(t))return e(t);if(this.isTagged(t))return this.ref(t);var o=null;if(r.isArray(t)){o=[],t[this.refcode]=this.tag(o);for(var n=0;n<t.length;n++)o.push(this.visit(t[n],e,i))}else{o=Object.create(Object.getPrototypeOf(t)),t[this.refcode]=this.tag(o);for(var s in t){var a=t[s];if(t.hasOwnProperty(s)){if(i&&void 0!==a&&(a=i.call(t,s,t[s]),void 0===a))continue;o[s]=this.visit(a,e,i)}}}return o[this.origcode]=t,this.ref(o)},r.prototype.handleAtom=function(t){var e=r.GLOBAL.Node||function(){};if(r.isFunction(t))throw new this.Error("Can't serialize functions.");if(t instanceof e){var i=new XMLSerializer;return this.builder("Resurrect.Node",[i.serializeToString(t)])}if(r.isDate(t))return this.builder("Date",[t.toISOString()]);if(r.isRegExp(t)){var o=t.toString().match(/\/(.+)\/([gimy]*)/).slice(1);return this.builder("RegExp",o)}return void 0===t?this.ref(void 0):!r.isNumber(t)||!isNaN(t)&&isFinite(t)?t:this.builder("Number",[t.toString()])},r.prototype.replacerWrapper=function(t){var e=new RegExp("^"+r.escapeRegExp(this.prefix));return function(r,i){return e.test(r)?i:t(r,i)}},r.prototype.stringify=function(t,e,i){if(r.isFunction(e))e=this.replacerWrapper(e);else if(r.isArray(e)){var o=e;e=function(t,e){return o.indexOf(t)>=0?e:void 0}}if(r.isAtom(t))return JSON.stringify(this.handleAtom(t),e,i);this.table=[],this.visit(t,this.handleAtom.bind(this),e);for(var n=0;n<this.table.length;n++)this.cleanup?delete this.table[n][this.origcode][this.refcode]:this.table[n][this.origcode][this.refcode]=null,delete this.table[n][this.refcode],delete this.table[n][this.origcode];var s=this.table;return this.table=null,JSON.stringify(s,null,i)},r.prototype.fixPrototype=function(t){if(this.prefix in t){var e=t[this.prefix],r=this.resolver.getPrototype(e);if("__proto__"in t)return t.__proto__=r,this.cleanup&&delete t[this.prefix],t;var i=Object.create(r);for(var o in t)t.hasOwnProperty(o)&&o!==this.prefix&&(i[o]=t[o]);return i}return t},r.prototype.resurrect=function(t){var e=null,i=JSON.parse(t);if(r.isArray(i)){if(this.table=i,this.revive)for(var o=0;o<this.table.length;o++)this.table[o]=this.fixPrototype(this.table[o]);for(o=0;o<this.table.length;o++){var n=this.table[o];for(var s in n)n.hasOwnProperty(s)&&(r.isAtom(n[s])||(n[s]=this.decode(n[s])))}e=this.table[0]}else r.isObject(i)?(this.table=[],e=this.decode(i)):e=i;return this.table=null,e},t.exports=r}})});